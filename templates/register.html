{% extends "base.html" %}

{% block title %}Register - Digital Will Management System{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0 text-center">
                    <i class="fas fa-user-plus"></i> Create Your Account
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('register') }}" id="registerForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="full_name" class="form-label">Full Name <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="full_name" name="full_name" 
                                       placeholder="Enter your full name" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                <input type="email" class="form-control" id="email" name="email" 
                                       placeholder="Enter your email" required>
                            </div>
                        </div>
                    </div>

                    <!-- NEW PASSWORD FIELD -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="password" name="password"
                                       placeholder="Enter a password" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       placeholder="+250 XXX XXX XXX" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="dob" class="form-label">Date of Birth <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                <input type="date" class="form-control" id="dob" name="dob" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                <textarea class="form-control" id="address" name="address" rows="2" 
                                          placeholder="Enter your full address" required></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="role" class="form-label">Account Type <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                            <select class="form-select" id="role" name="role" required>
                                <option value="">Select account type...</option>
                                <option value="testator">Testator (Will Creator)</option>
                                <option value="executor">Executor</option>
                                <option value="beneficiary">Beneficiary</option>
                            </select>
                        </div>
                        <div id="roleDescription" class="mt-2 text-muted small"></div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a>
                                <span class="text-danger">*</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                    </div>
                </form>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <p class="mb-2">Already have an account?</p>
                    <a href="{{ url_for('login') }}" class="btn btn-outline-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Terms and Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptance of Terms</h6>
                <p>By registering for and using the Digital Will Management System, you agree to these terms and conditions.</p>
                
                <h6>2. User Responsibilities</h6>
                <p>You are responsible for maintaining the confidentiality of your account credentials and for all activities under your account.</p>
                
                <h6>3. Data Privacy</h6>
                <p>We are committed to protecting your personal information and will use it only in accordance with our privacy policy.</p>
                
                <h6>4. Service Usage</h6>
                <p>The service is provided for legitimate will management purposes only. Any misuse may result in account termination.</p>
                
                <h6>5. Limitation of Liability</h6>
                <p>While we strive to provide accurate and reliable services, we cannot guarantee the legal validity of wills created through this platform in all jurisdictions.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
// Role descriptions
const roleDescriptions = {
    'testator': 'As a Testator, you can create and manage your digital wills, add assets, assign beneficiaries, and appoint executors.',
    'executor': 'As an Executor, you will manage the execution of wills assigned to you, handle asset transfers, and communicate with beneficiaries.',
    'beneficiary': 'As a Beneficiary, you can view assets assigned to you, track transfer status, and access relevant documents.'
};

document.getElementById('role').addEventListener('change', function() {
    document.getElementById('roleDescription').innerHTML =
        roleDescriptions[this.value] || '';
});

document.getElementById('phone').addEventListener('input', function(e) {
    let v = e.target.value.replace(/\D/g, '');
    if (v.startsWith('250')) v = v.slice(0,12);
    e.target.value = v;
});

document.getElementById('registerForm').addEventListener('submit', function(e) {
    const fullName = document.getElementById('full_name').value.trim();
    const email    = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const phone    = document.getElementById('phone').value.trim();
    const dob      = document.getElementById('dob').value;
    const address  = document.getElementById('address').value.trim();
    const role     = document.getElementById('role').value;
    const terms    = document.getElementById('terms').checked;

    if (!fullName || fullName.length < 3) {
        alert('Enter a valid full name (min 3 chars)');
        e.preventDefault(); return;
    }
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRe.test(email)) {
        alert('Enter a valid email'); e.preventDefault(); return;
    }
    if (!password) {
        alert('Password is required'); e.preventDefault(); return;
    }
    const phoneRe = /^(\+?250|0)?[7][2-9]\d{7}$/;
    if (!phoneRe.test(phone)) {
        alert('Enter a valid Rwanda phone'); e.preventDefault(); return;
    }
    const bd   = new Date(dob), now = new Date();
    let age = now.getFullYear() - bd.getFullYear();
    const mDiff = now.getMonth() - bd.getMonth();
    if (mDiff < 0 || (mDiff === 0 && now.getDate() < bd.getDate())) age--;
    if (age < 18) {
        alert('You must be 18+'); e.preventDefault(); return;
    }
    if (!address || address.length < 10) {
        alert('Enter a complete address'); e.preventDefault(); return;
    }
    if (!role) {
        alert('Select an account type'); e.preventDefault(); return;
    }
    if (!terms) {
        alert('You must agree to terms'); e.preventDefault(); return;
    }
});
</script>
{% endblock %}
